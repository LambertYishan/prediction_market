<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Prediction Market</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>Available Markets</h1>
    <nav>
      <a href="index.html">Home</a>
      <a href="admin.html">Admin</a>
      <a href="portal.html" id="portal-link">My Portal</a>
      <a href="#" id="logout-link">Logout</a>
      <span id="user-greeting" style="margin-left:10px; font-weight:bold;"></span>
    </nav>
  </header>

  <main>
    <div id="market-list"></div>
  </main>

  <script src="script.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      await updateUserGreeting();

      const res = await fetch(`${apiBase}/markets`);
      const markets = await res.json();

      const container = document.getElementById("market-list");
      container.innerHTML = "";

      if (!markets || markets.length === 0) {
        container.innerHTML = "<p>No markets available yet.</p>";
        return;
      }

      for (const m of markets) {
        const card = document.createElement("div");
        card.classList.add("market-card");
        card.innerHTML = `
          <h2>${m.title}</h2>
          <p>${m.description || ""}</p>
          <p>Status: ${m.status}</p>
          <p>YES: ${(m.price_yes * 100).toFixed(1)}% | NO: ${(m.price_no * 100).toFixed(1)}%</p>
          <p>Expires: ${new Date(m.expires_at).toLocaleString()}</p>
          <a href="market.html?id=${m.id}" class="btn">View Market</a>
        `;
        container.appendChild(card);
      }
    });
  </script>
</body>
</html>
